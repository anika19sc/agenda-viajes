<ion-header class="ion-no-border">
  <div style="background-color: #1b3a61;" class="p-4 pt-safe text-white">
    <div class="flex justify-between items-center mb-2">
      <ion-buttons slot="start">
        <ion-menu-button color="light"></ion-menu-button>
      </ion-buttons>
      <div class="text-center flex flex-col items-center flex-1">
        <img src="assets/logo.jpg" alt="Logo"
          class="w-16 h-16 sm:w-20 sm:h-20 rounded-full border-2 border-white shadow-lg">
      </div>
      <div class="w-12"></div> <!-- Spacer for symmetry -->
    </div>

    <!-- Date Navigation -->
    <div class="flex justify-between items-center bg-white/10 rounded-2xl p-2 px-4 shadow-inner">
      <ion-button fill="clear" size="small" (click)="prevDay()" class="text-white">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
      <div class="text-center">
        <h2 class="text-sm font-black m-0 uppercase tracking-wider">
          {{ (currentDate() + 'T12:00:00') | date:'EEEE d, MMMM' }}
        </h2>
      </div>
      <ion-button fill="clear" size="small" (click)='nextDay()' class="text-white">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" class="bg-slate-50">
  <!-- Section Tabs -->
  <div class="flex p-2 bg-white sticky top-0 z-10 shadow-sm">
    <button (click)="selectedSection.set('ida')" [style.background-color]="selectedSection() === 'ida' ? '#f7941d' : ''"
      [class.text-white]="selectedSection() === 'ida'"
      class="flex-1 py-3 px-2 rounded-xl font-bold text-xs transition-all text-slate-600">
      VIAJE DE IDA
    </button>
    <button (click)="selectedSection.set('encomienda')"
      [style.background-color]="selectedSection() === 'encomienda' ? '#f7941d' : ''"
      [class.text-white]="selectedSection() === 'encomienda'"
      class="flex-1 py-3 px-2 rounded-xl font-bold text-xs transition-all ml-2 text-slate-600">
      ENCOMIENDA
    </button>
    <button (click)="selectedSection.set('vuelta')"
      [style.background-color]="selectedSection() === 'vuelta' ? '#f7941d' : ''"
      [class.text-white]="selectedSection() === 'vuelta'"
      class="flex-1 py-3 px-2 rounded-xl font-bold text-xs transition-all ml-2 text-slate-600">
      VIAJE DE VUELTA
    </button>
  </div>

  <!-- Trip List -->
  <div class="p-4 mb-24">
    <div *ngIf="trips().length === 0" class="flex flex-col items-center justify-center py-24 sm:py-32 text-slate-400">
      <ion-icon name="calendar-outline" class="text-7xl sm:text-8xl mb-4 opacity-50"></ion-icon>
      <p class="font-bold text-lg sm:text-xl">No hay registros hoy</p>
      <p class="text-sm opacity-70 mt-1">Toc√° el bot√≥n naranja para empezar</p>
    </div>

    <ion-list lines="none" class="bg-transparent">
      <ng-container *ngFor="let trip of trips()">
        <ion-item-sliding *ngIf="trip.section === selectedSection()">
          <ion-item class="mb-3 rounded-2xl shadow-sm overflow-hidden"
            style="--inner-padding-end: 0; --padding-start: 12px;">
            <div class="flex items-center w-full py-3">
              <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mr-4">
                <ion-icon [name]="trip.section === 'encomienda' ? 'cube' : 'person'" style="color: #49bfa8;"
                  class="text-xl"></ion-icon>
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-slate-800 m-0">{{ trip.description }}</h3>
                <p *ngIf="trip.time" class="text-xs text-slate-500 m-0 mt-1">
                  üïê {{ trip.time }}
                </p>
              </div>
              <div class="text-right pr-4">
                <span class="font-black text-lg text-emerald-600">{{ trip.amount | currency:'ARS':'symbol':'1.2-2'
                  }}</span>
              </div>
            </div>
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option color="danger" (click)="deleteTrip(trip)" class="rounded-2xl ml-2">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </ng-container>
    </ion-list>
  </div>

  <div class="p-4 pb-56"></div>
</ion-content>

<!-- Floating Actions -->
<div class="fixed bottom-0 left-0 right-0 p-6 bottom-bar-safe bg-gradient-to-t from-white via-white to-transparent">
  <div class="flex gap-4 items-center max-w-lg mx-auto">
    <button (click)="manualEntry()" style="color: #1b3a61;"
      class="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-white shadow-xl border-2 border-slate-100 flex items-center justify-center transform active:scale-90 transition-all">
      <ion-icon name="create-outline" class="text-2xl"></ion-icon>
    </button>

    <div class="flex-1 flex flex-col items-center">
      <div *ngIf="isRecording()" class="w-full mb-4 px-4 bg-slate-900/5 rounded-2xl py-2">
        <app-waveform [stream]="audioStream()"></app-waveform>
        <p class="text-center text-xs font-bold animate-pulse mt-1" style="color: #f7941d;">ESCUCHANDO...</p>
      </div>

      <button (click)="recordVoice()" style="background-color: #f7941d;" [class.scale-105]="isRecording()"
        class="w-full h-16 sm:h-20 rounded-3xl text-white shadow-2xl flex items-center justify-center gap-3 transform active:scale-95 transition-all outline-none">
        <div [style.background-color]="isRecording() ? '#fdba74' : '#e67e22'"
          class="rounded-full p-2 sm:p-3 pulse-animation">
          <ion-icon [name]="isRecording() ? 'stop' : 'mic'" class="text-2xl sm:text-3xl"></ion-icon>
        </div>
        <span class="text-lg sm:text-xl font-black uppercase tracking-widest text-white">{{ isRecording() ? 'DETENER' :
          'GRABAR'
          }}</span>
      </button>
    </div>

    <button (click)="shareSummary()"
      class="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-emerald-500 text-white shadow-xl flex items-center justify-center transform active:scale-90 transition-all">
      <ion-icon name="logo-whatsapp" class="text-2xl"></ion-icon>
    </button>
  </div>
</div>